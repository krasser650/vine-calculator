let unitOfMeasurement=!0,isSimplifiedCalculationSystem=!1,collapsed=!0;function calcDellCof(){resetResult();let e=parseFloat(document.getElementById("sugarTarget").value),t=parseFloat(document.getElementById("alcoholTarget").value);if(isNaN(t)||t<0||isNaN(e)||e<0)return null;let l=document.getElementById("conservationUnit");const a=e+4.5*t;return a<80?(l.textContent="Кількість CU : ",l.textContent+=a.toFixed(2),l.style.color="red"):(l.textContent="Кількість CU : ",l.textContent+=a.toFixed(2),l.style.color="green"),{A_t:t/100,S_t:10*e}}function calcResult(){let e=Number(10*document.getElementById("sugar-vine-start_id").value),t=Number(document.getElementById("amount-wine_id").value),l=Number(document.getElementById("alcohol-blend_id").value/100),a=Number(10*document.getElementById("alcohol-blend-sugar_id").value),o=e,n=calcDellCof();if(!n||[t,e,l].some(e=>isNaN(e)||e<=0)||isNaN(a)||a<0)return void resetResultBox();unitOfMeasurement||(e=10*(.26678527537*e/10-269.55213512));let r=n.A_t,s=n.S_t,i=document.getElementById("resultBox"),d=l-r-(s-a)/1600;if(Math.abs(d)<1e-6)return i.className="alert alert-danger",void(i.textContent="Помилка: некоректні параметри (ділення на 0)");let c=(s*(l-r)+(r-e/1600)*(s-a))/d,u=(e-c)/1600,m=1e3*(1e-4*o-100*u/131.25),v=t*(r-u)/(l-r),p=t*(s-c)/(a-s),b=(v+p)/2,g=Math.abs(v-p)/b*100,f="alert-info",x="#198754",y="";g>10?(f="alert-danger",x="#dc3545",y=`Різниця між розрахунком по спирту та цукру: ${g.toFixed(1)}% (неузгоджено!)`):g>5&&(f="alert-warning",x="#ffc107",y=`Різниця між розрахунком по спирту та цукру: ${g.toFixed(1)}% (увага)`);let h=`<div class="progress mb-2" style="height: 8px;"> <div class="progress-bar" role="progressbar"\n      style="width: ${Math.min(g,100)}%; background-color: ${x};"></div>\n    </div>\n  `;if([c,u,b].some(e=>isNaN(e)||e<=0)||!unitOfMeasurement&&(isNaN(m)||m<=0))return i.className="alert alert-danger",void(i.textContent="Помилка: некоректні параметри!");let E=unitOfMeasurement?`<b>Об'єм AM:</b> ${b.toFixed(2)} л (по спирту: ${v.toFixed(2)} л, по цукру: ${p.toFixed(2)} л)<br>\n    <b>Момент спиртування:</b>  цукристість ≈ ${c.toFixed(1)} г/л (${(c/10).toFixed(2)} °Bx)<br>\n    <b>Спиртуозність сусла на момент спиртування:</b> ${(100*u).toFixed(2)} об. %<br>\n    ${y}`:`<b>Початкова цукристість сусла:</b> ${(.1*e).toFixed(2)} г/100см<sup>3</sup><br>\n    <b>Об'єм AM:</b> ${b.toFixed(2)} л (по спирту: ${v.toFixed(2)} л, по цукру: ${p.toFixed(2)} л)<br>\n    <b>Момент спиртування:</b>  густина ≈ ${m.toFixed(1)} г/л (цукор : ${(c/10).toFixed(2)} °Bx)<br>\n    <b>Спиртуозність сусла на момент спиртування:</b> ${(100*u).toFixed(2)} об. %<br>\n    ${y}`;i.className=`alert ${f}`,i.innerHTML=h+E}function addAlertPlaceholder(e,t){if(document.getElementById("alert_id"))return;document.getElementById("liveAlertPlaceholder").innerHTML=[`<div class="alert alert-${t} alert-dismissible" role="alert" id="alert_id">`,`   <div>${e}</div>`,'   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',"</div>"].join("")}function removeAlertPlaceholder(){let e=document.getElementById("liveAlertPlaceholder"),t=document.getElementById("alert_id");e&&t&&e.removeChild(t)}function resetAll(){document.getElementById("calcForm").querySelectorAll("input").forEach(e=>{e.value="0",e.classList.remove("is-invalid","is-valid")}),resetResult(),removeAlertPlaceholder()}function resetResult(){resetResultBox(),resetCU()}function resetResultBox(){let e=document.getElementById("resultBox");e.className="alert alert-secondary",e.textContent="Заповніть кроки 1 и 2"}function resetCU(){let e=document.getElementById("conservationUnit");e.textContent="Кількість CU : не розраховано",e.style.color="black"}function changeMeasurementMethod(e){const t=document.getElementById("wortParameter_id");if(t){t.innerHTML=e?['<div id="parameter_id">','   <p class="desc">Додайте показники цукристості сусла, його кількість та\n                     спиртуозність <strong>спиртовмісного матеріалу</strong> (далі AМ)\n                            , яким плануєте проводити стабілізацію</p>','   <div class="mb-3"> <label for="sugar-vine-start_id" class="form-label">Початкова цукристість сусла, г/100см<sup>3</sup></label> <input type="number" class="form-control" id="sugar-vine-start_id" required value="0" min="15" max="35" step="0.5" placeholder="Початкова цукристість" oninput="resetResult()"></div> ',"</div>"].join(""):['<div id="parameter_id">','   <p class="desc">Додайте показники густини сусла, його кількість та\n                     спиртуозність <strong>спиртовмісного матеріалу</strong> (далі AМ)\n                            , яким плануєте проводити стабілізацію</p>','   <div class="mb-3"> <label for="sugar-vine-start_id" class="form-label">Початкова густина сусла, г/л.</label> <input type="number" class="form-control" id="sugar-vine-start_id" required value="0" min="1065" max="1200" step="5" placeholder="Початкова густина" oninput="resetResult()"></div> ',"</div>"].join("");let l=document.getElementById("sugar-vine-start_id");l.addEventListener("input",()=>{resetResult(),addEventForInput(l)}),resetResultBox(),unitOfMeasurement=e}}function changeCalculationSystem(){if(isSimplifiedCalculationSystem){const e=document.getElementById("alcoholBlendSugar_id");e&&e.remove()}else;}function expandAccordion(){const e=document.getElementById("accordionId"),t=e.querySelectorAll(".accordion-collapse"),l=e.querySelectorAll("button");e&&t&&l&&(collapsed?(t.forEach(e=>{e.classList.add("show")}),l.forEach(e=>{e.classList.remove("collapsed"),e.setAttribute("aria-expanded","true")})):(t.forEach(e=>{e.classList.remove("show")}),l.forEach(e=>{e.classList.add("collapsed"),e.setAttribute("aria-expanded","false")})),collapsed=!collapsed)}function addEventForInput(e){let t=parseFloat(e.value);""===e.value||t<=0||isNaN(t)?(e.classList.add("is-invalid"),e.classList.remove("is-valid")):(e.classList.add("is-valid"),e.classList.remove("is-invalid")),"alcoholTarget"!==e.id&&"sugarTarget"!==e.id||calcDellCof(),Array.from(document.querySelectorAll("#calcForm input")).every(e=>""!==e.value&&parseFloat(e.value)>=0&&!isNaN(parseFloat(e.value)))&&calcResult()}document.querySelectorAll("#calcForm input").forEach(e=>{e.addEventListener("input",()=>{resetResult(),addEventForInput(e)})});const tooltipTriggerList=document.querySelectorAll('[data-bs-toggle="tooltip"]'),tooltipList=[...tooltipTriggerList].map(e=>new bootstrap.Tooltip(e));
