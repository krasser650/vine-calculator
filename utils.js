function makeIntOnly(e,t=null){e.addEventListener("input",()=>{let t=e.value;t=t.replace(/[^0-9.,]/g,"");const n=t.search(/[.,]/);if(-1!==n){const e=t.slice(0,n+1),r=t.slice(n+1).replace(/[.,]/g,"");t=e+r}t=t.replace(/^0+(?=\d)/,""),t=t.replace(",","."),e.value=t}),e.addEventListener("blur",()=>{let t=e.value;/[.,]$/.test(t)&&(0===parseFloat(t.replace(",","."))?t="0":t+="0"),t=t.replace(",","."),e.value=t})}function validationInput(e){void 0===e.dataset.prevValue&&(e.dataset.prevValue=e.value);const t=e.value.trim().replace(",","."),n=parseFloat(t);if(!(!isNaN(n)&&/^-?\d*[.,]?\d*$/.test(t))&&""!==t)return void(e.value=e.dataset.prevValue);e.dataset.prevValue=e.value;const r=""===t||isNaN(n)||n<0||"Ss"!==e.id&&n<=0;e.classList.toggle("is-invalid",r),e.classList.toggle("is-valid",!r)}function checkTemperature(e,t,n,r,o,s){const a=null!==t?{t0:"Початкова температура сусла",tCurr:"Поточна температура сусла"}:{t0:"Температура сусла",tCurr:""};return isNaN(e)||e<lowTemp||e>highTemp?(r.innerHTML=`<b>Зверніть увагу!</b><br>${a.t0} <b>${0===e||isNaN(e)?"":e}</b> °С\n            за межами діапазону [<b>${lowTemp}-${highTemp}</b>] °С`,r.classList.remove("none-d"),o.classList.add("d-none"),o.textContent="",s.textContent="",!0):isNaN(n)||n<lowTemp||n>highTemp?(r.innerHTML=`<b>Зверніть увагу!</b><br>Tемпература калібрування приладу <b>${0===n||isNaN(n)?"":n}</b> °С за межами діапазону [<b>${lowTemp}-${highTemp}</b>] °С`,r.classList.remove("none-d"),o.classList.add("d-none"),o.textContent="",s.textContent="",!0):null===t?(r.classList.add("none-d"),!1):isNaN(t)||t<lowTemp||t>highTemp?(r.innerHTML=`<b>Зверніть увагу!</b><br>${a.tCurr} <b>${0===t||isNaN(t)?"":t}</b> °С\n            за межами діапазону [<b>${lowTemp}-${highTemp}</b>] °С`,r.classList.remove("none-d"),o.classList.add("d-none"),o.textContent="",s.textContent="",!0):(r.classList.add("none-d"),!1)}function CheckReadingsForFermentTable(e,t,n,r,o,s){const a=e?hydrometerRange:refractometerRange,l=e?"ареометра":"рефрактометра";return n<a.low&&t<a.high||isNaN(t)||isNaN(n)?(o.classList.add("none-d"),o.innerHTML="",r.classList.add("d-none"),r.textContent="",s.textContent="",!0):t<=n?(o.classList.remove("none-d"),o.innerHTML=`<b>Зверніть увагу!</b><br> Поточні покази ${l} мають бути меньше початкових`,r.classList.add("d-none"),r.textContent="",s.textContent="",!0):n<a.low||n>a.high?(o.classList.remove("none-d"),o.innerHTML=`<b>Зверніть увагу!</b><br>Покази ${l} мають бути в межах діапазону\n        [<b>${a.high}-${a.low}</b>] г/л`,r.classList.add("d-none"),r.textContent="",s.textContent="",!0):t>a.high||n<a.low?(o.classList.remove("none-d"),o.innerHTML=`<b>Зверніть увагу!</b><br>Один із показів ${l} за межали діапазону\n        [<b>${a.high}-${a.low}</b>] г/л`,r.classList.add("d-none"),r.textContent="",s.textContent="",!0):!(!isNaN(t)&&!isNaN(n))||(o.classList.add("none-d"),!1)}function checkBoundsRange(e,t,n,r,o,s,a){const l=e?"ареометра":"рефрактометра";return isNaN(t)||t<n||t>r?(o.innerHTML=`<b>Зверніть увагу!</b><br>Покази ${l} <b>${0===t||isNaN(t)?"":t}</b> за межами діапазону вимірювання [<b>${r}-${n}</b>]`,o.classList.remove("none-d"),s.classList.add("d-none"),s.textContent="",a.textContent="",!0):(o.classList.add("none-d"),!1)}function correctReadingsTemp(e,t,n,r){return t+(e?coffDensityTempCorrect:coffBxTempCorrect)*(n-r)}function correctSG(e,t,n){return+(1e3*(.001*e*(1+214e-6*(t-n)))).toFixed(2)}function createInterpolator(e){const t=e.slice().sort((e,t)=>e.x-t.x);return{f:function(e){if(e<=t[0].x)return t[0].y;if(e>=t[t.length-1].x)return t[t.length-1].y;let n=0,r=t.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),s=t[o].x;if(s===e)return t[o].y;s<e?n=o+1:r=o-1}const o=Math.max(0,r),s=t[o],a=t[o+1];return s.y+(e-s.x)/(a.x-s.x)*(a.y-s.y)},inv:function(e){if(e<=t[0].y)return t[0].x;if(e>=t[t.length-1].y)return t[t.length-1].x;let n=0,r=t.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),s=t[o].y;if(s===e)return t[o].x;s<e?n=o+1:r=o-1}const o=Math.max(0,r),s=t[o],a=t[o+1];return s.x+(e-s.y)/(a.y-s.y)*(a.x-s.x)}}}document.querySelectorAll(".int-only").forEach(e=>makeIntOnly(e)),document.querySelectorAll(".int-only-3dec").forEach(e=>makeIntOnly(e,3));const densityToBx=createInterpolator(densityBxPoints),densityToSugar=createInterpolator(densitySugarPoints),bxToSugar=createInterpolator(bxSugarPoints);function updateSelectOptions(e,t,n,r){const o=document.getElementById(e),s=document.getElementById(n);if(s)if(o){o.innerHTML=t,s.innerHTML="";for(const e of r){const t=document.createElement("option");t.value=e.value,t.textContent=e.text,e.selected&&(t.selected=!0),s.appendChild(t)}![...s.options].some(e=>e.selected)&&s.options.length>0&&(s.options[0].selected=!0)}else console.warn(`Label с id="${e}" не найден`);else console.warn(`Select с id="${n}" не найден`)}function updateInputOptions(e,t,n,r,o){let s=document.getElementById(e),a=document.getElementById(n);a?s?(s.innerHTML=t,a.placeholder=o,a.value=r):console.warn(`Label с id="${e}" не найден`):console.warn(`Input с id="${n}" не найден`)}function checkDecimal(e){return e-Math.trunc(e)>0}function formatNumberByPattern(e,t){let n=e.toString(),r=parseFloat(n.replace(",","."));if(isNaN(r))return n;const[o,s=""]=t.split("."),a=(s.match(/0/g)||[]).length,l=s.length;let i=r.toFixed(l);if(l>a){const e=new RegExp(`(\\.\\d{${a}}[1-9]*)0+$`);i=i.replace(e,"$1")}if(i=i.replace(/\.$/,""),o.includes(",")){const[e,t]=i.split("."),n=e.replace(/\B(?=(\d{3})+(?!\d))/g,",");i=t?`${n}.${t}`:n}return i}function interpolateK(e,t,n){const r=(e,t,n)=>e+(t-e)*n,o=(s=e.map(e=>e.start),[...new Set(s)].sort((e,t)=>e-t));var s;let a=o[0],l=o.at(-1);for(let e=0;e<o.length-1;e++)t>=o[e]&&t<=o[e+1]&&([a,l]=[o[e],o[e+1]]);const i=e=>{const t=e.sort((e,t)=>e.current-t.current);for(let e=0;e<t.length-1;e++){const o=t[e],s=t[e+1];if(n>=o.current&&n<=s.current)return r(o.k,s.k,(n-o.current)/(s.current-o.current))}return n<t[0].current?t[0].k:t.at(-1).k},c=i(e.filter(e=>e.start===a)),d=i(e.filter(e=>e.start===l));return+r(c,d,(t-a)/(l-a)).toFixed(4)}