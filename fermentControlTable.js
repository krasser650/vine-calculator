let isHydrometerT2=!0;function genFermentTable(){isHydrometerT2?genFermentTableByDensity():genFermentTableByRefract()}function changeMeasuringDeviceForT2(e){const t=document.getElementById("tabFermentationControl"),n=document.getElementById("resultContainer_tbl2");document.getElementById("alertFermentBox").classList.add("none-d"),n.innerHTML="",n.classList.add("d-none"),t.innerHTML="",e?(updateInputOptions("lblStartInstrumentReadings","Початкова густина сусла <code>(D0)</code>, г/л","D_start","0","Вкажіть початкову густину"),updateInputOptions("lblMomentInstrumentReadings","Поточна густина сусла <code>(DC)</code>, г/л","D_current","0","Вкажіть цільову густину"),updateSelectOptions("lblStepFermentControlTable","Крок розрахунку <code>(step)</code></label>, г/л","step_fermentTable",densityStepOptions)):(updateInputOptions("lblStartInstrumentReadings","Початкові покази рефрактометра, °Bx","D_start","0","Вкажіть покази рефрактометра"),updateInputOptions("lblMomentInstrumentReadings","Поточні покази рефрактометра, °Bx","D_current","0","Вкажіть покази рефрактометра"),updateSelectOptions("lblStepFermentControlTable","Крок розрахунку <code>(step)</code></label>, °Bx","step_fermentTable",bxStepOptions)),isHydrometerT2=!isHydrometerT2}function genFermentTableByDensity(){let e=document.getElementById("tabFermentationControl"),t=document.getElementById("resultContainer_tbl2"),n=document.getElementById("alertFermentBox"),s=(Number(document.getElementById("tempCalibrationHydrometerT2").value),parseFloat(document.getElementById("D_start").value)),d=Number(document.getElementById("D_current").value),r=Number(document.getElementById("step_fermentTable").value);if(CheckReadingsForFermentTable(isHydrometerT2,s,d,t,n,e))return;let l='\n    <table class="table table-sm table-striped align-middle caption-top table-bordered">\n     <caption>\n        <small>* Таблиця розрахована для температури сусла 20 °C</small>\n    </caption>\n      <thead class="table-sticky-thead table-warning">\n        <tr>\n          <th class="text-center">Густина,<br>г/л</th>\n          <th class="text-center">Спирт,<br> об.%</th>\n          <th class="text-center">Цукор,<br> г/100 cm<sup>3</sup></th>\n        </tr>\n      </thead>\n      <tbody class="table-group-divider">',i=densityToSugar.f(.001*s),a=densityToBx.f(.001*s)*s*.001-i,c=0,o=0,u=0,m=0;for(let e=s;e>980;e-=r)if(e>d){let t=.131*(s-e);const n=i-1.69*t;if(n<0)break;l+=`\n              <tr>\n                <td class="text-center">\n                  <div>${e}</div>\n                </td>\n                <td class="text-center">\n                  <div>${t.toFixed(2)}</div>\n                </td>\n                <td class="text-center">\n                  <div>${n.toFixed(2)}</div>\n                </td>\n              </tr>`,checkDecimal(e)&&(e=Math.trunc(e))}else{let t=.131*(s-d);const n=i-1.69*t;if(n<0)break;l+=`\n                <tr class="table-primary">\n                <td class="text-center">\n                  <div><b>${checkDecimal(d)?d:d.toFixed(0)}</b></div>\n                </td>\n                 <td class="text-center">\n                  <div><b>${t.toFixed(2)}</b></div>\n                </td>\n                <td class="text-center">\n                  <div><b>${n.toFixed(2)}</b></div>\n                </td>\n              </tr>`,c=t,o=n,u=1.69*t,(checkDecimal(d)||e-d!==0)&&(e+=r),m=d,d=0}if(0!==d&&0===m)return n.classList.remove("none-d"),n.innerHTML="<b>Зверніть увагу!</b><br>\n          Поточна густина не потрапляє до результатів розрахунку.<br>\n           <b>Порада</b> , спробуйте зменшити крок розрахунку, іноді це спрацьовує",t.classList.add("d-none"),t.textContent="",void(e.textContent="");let v=`\n    <div class="px-2">\n            <b>РЕЗУЛЬТАТ:</b>\n            <div class="row">\n                <div class="col-sm-4"> Спиртуозність</div>\n                <div class="col-sm-7 result result2"><b>${c.toFixed(2)}</b> об.%</div>\n            </div>\n            <div class="row">\n                <div class="col-sm-4">Цукристість</div>\n                <div class="col-sm-7 result result2"><b>${o.toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n            </div>\n             <hr class="separator">\n            <b>ДОДАТКОВО:</b>\n            <div class="row">\n                <div class="col-sm-4">Різниця густин</div>\n                <div class="col-sm-7 result result2"><b>${(s-m).toFixed(2)}</b> г/л</div>\n            </div>\n             <div class="row">\n                <div class="col-sm-4">Початкова цукристість</div>\n                <div class="col-sm-7 result result2"><b>${i.toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n             </div>\n             <div class="row">\n                <div class="col-sm-4">Зброджені цукри</div>\n                <div class="col-sm-7 result result2"><b>${u.toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n             </div>\n             <div class="row">\n                <div class="col-sm-4">Екстракт</div>\n                <div class="col-sm-7 result result2"><b>${(a+o).toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n             </div>\n             <div class="row">\n                <div class="col-sm-4">Зведений екстракт</div>\n                <div class="col-sm-7 result result2"><b>${a.toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n             </div>\n             <div class="row">\n                <div class="col-sm-4"> Потенційна спиртуозність</div>\n                <div class="col-sm-7 result result2"><b>${(.592*i).toFixed(2)}</b> об.%</div>\n             </div>\n    </div>\n     `;n.classList.add("none-d"),n.textContent="",t.className="alert alert-primary",t.classList.remove("d-none"),t.innerHTML=v,l+="</tbody></table>",e.innerHTML=l}function genFermentTableByRefract(){let e=document.getElementById("tabFermentationControl"),t=document.getElementById("resultContainer_tbl2"),n=document.getElementById("alertFermentBox"),s=(Number(document.getElementById("tempCalibrationRefractorsT2").value),parseFloat(document.getElementById("D_start").value)),d=Number(document.getElementById("D_current").value),r=Number(document.getElementById("step_fermentTable").value);if(CheckReadingsForFermentTable(isHydrometerT2,s,d,t,n,e))return;let l='\n    <table class="table table-sm table-striped align-middle caption-top table-bordered">\n     <caption>\n        <small>* Таблиця розрахована для температури сусла 20 °C</small>\n    </caption>\n      <thead class="table-sticky-thead table-warning">\n        <tr>\n          <th class="text-center">Поточні,<br> °Bx</th>\n          <th class="text-center">Спирт,<br> об.%</th>\n          <th class="text-center">Цукор,<br> г/100 cm<sup>3</sup></th>\n        </tr>\n      </thead>\n      <tbody class="table-group-divider">';const i=bxToSugar.f(s),a=densityToBx.inv(s);let c=a*s-i,o=0,u=0,m=0,v=0,b=0;for(let e=s;e>5;e-=r)if(Math.round(10*e)/10>d){const t=getSugarSpiritValue(s,e),n=t.spirit_current,d=t.sugar_current;if(d<0)break;l+=`\n              <tr>\n                <td class="text-center">\n                   <div>${formatNumberByPattern(e,"###0.0#")}</div>\n                </td>\n                <td class="text-center">\n                  <div>${n.toFixed(2)}</div>\n                </td>\n                <td class="text-center">\n                  <div>${d.toFixed(2)}</div>\n                </td>\n              </tr>`,e=correctStep(r,e)}else{const t=getSugarSpiritValue(s,d),n=t.spirit_current,i=t.sugar_current;if(i<0)break;l+=`\n                <tr class="table-primary">\n                <td class="text-center">\n                  <div><b>${formatNumberByPattern(d,"###0.0#")}</b></div>\n                </td>\n                 <td class="text-center">\n                  <div><b>${n.toFixed(2)}</b></div>\n                </td>\n                <td class="text-center">\n                  <div><b>${i.toFixed(2)}</b></div>\n                </td>\n              </tr>`,u=n,m=i,v=t.sugar-i,o=a-n/131,d!==Math.round(10*e)/10&&(e+=r),b=d,d=0}if(0!==d&&0===b)return n.classList.remove("none-d"),n.innerHTML="<b>Зверніть увагу!</b><br>\n          Поточні покази рефрактометра не потрапляють до результатів розрахунку.<br>\n          <b>Порада</b> , спробуйте зменшити крок розрахунку, іноді це спрацьовує",t.classList.add("d-none"),t.textContent="",void(e.textContent="");let p=`\n    <div class="px-2">\n            <b>РЕЗУЛЬТАТ:</b>\n            <div class="row">\n                <div class="col-sm-4"> Спиртуозність</div>\n                <div class="col-sm-7 result result2"><b>${u.toFixed(2)}</b> об.%</div>\n            </div>\n            <div class="row">\n                <div class="col-sm-4">Цукристість</div>\n                <div class="col-sm-7 result result2"><b>${m.toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n            </div>\n             <hr class="separator">\n            <b>ДОДАТКОВО:</b>\n             <div class="row">\n                <div class="col-sm-4">Початкова густина</div>\n                <div class="col-sm-7 result result2"><b>${(1e3*a).toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n             </div>\n              <div class="row">\n                <div class="col-sm-4">Поточна густина</div>\n                <div class="col-sm-7 result result2"><b>${(1e3*o).toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n             </div>\n             <div class="row">\n                <div class="col-sm-4">Початкова цукристість</div>\n                <div class="col-sm-7 result result2"><b>${i.toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n             </div>\n             <div class="row">\n                <div class="col-sm-4">Зброджені цукри</div>\n                <div class="col-sm-7 result result2"><b>${v.toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n             </div>\n             <div class="row">\n                <div class="col-sm-4">Екстракт</div>\n                <div class="col-sm-7 result result2"><b>${(c+m).toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n             </div>\n             <div class="row">\n                <div class="col-sm-4">Зведений екстракт</div>\n                <div class="col-sm-7 result result2"><b>${c.toFixed(2)}</b> г/100 cm<sup>3</sup></div>\n             </div>\n             <div class="row">\n                <div class="col-sm-4"> Потенційна спиртуозність</div>\n                <div class="col-sm-7 result result2"><b>${(.592*i).toFixed(2)}</b> об.%</div>\n             </div>\n    </div>\n     `;n.classList.add("none-d"),n.textContent="",t.className="alert alert-primary",t.classList.remove("d-none"),t.innerHTML=p,l+="</tbody></table>",e.innerHTML=l}function correctStep(e,t){switch(e){case 5:{if(!checkDecimal(t/e))return t;let n=0,s=Math.trunc(t);do{s%5!=0?s--:n=s}while(0===n);return n+e}case.5:{if(!checkDecimal(t))return t;let n=Math.trunc(t);return n+e>=t?n+e:n+2*e}case.2:{if(!checkDecimal(t/e))return t;let n=Math.trunc(t),s=Math.round(10*(t-n))/10;const d=Math.round(s/.2*10)/10;return checkDecimal(d)?n+(s+.1):Math.round(10*t)/10}case.1:return Math.round(10*t)/10;default:return Math.trunc(t)}}function getSugarSpiritValue(e,t){const n=densityToBx.inv(e),s=bxToSugar.f(e),d=interpolateK(bxCoffPoints,e,t),r=t*d+e*(1-d),l=r*n,i=n*e-s,a=l-i;return{bxTrue:r,extract:l,extract_combined:i,sugar_current:a,spirit_current:Math.round(100*(s-a))/100/1.69,d0:n,sugar:s}}document.querySelectorAll("#formTable_2 input").forEach(e=>{e.addEventListener("input",()=>{validationInput(e),genFermentTable()})});